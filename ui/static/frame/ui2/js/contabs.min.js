function secPageFn(url, sec) {
    $(".J_mainContent .J_iframe").each(function() {
        $(".J_iframe").hide();
        $(".J_iframe[data-state=\"secframe\"]").remove();

        var n = '<iframe class="J_iframe" name="iframe' + 0 + '" width="100%" height="100%" src="' + url + '" frameborder="0" data-id="' + url + '" seamless data-state="secframe"></iframe>';
        if ($(".J_mainContent").find("iframe.J_iframe").length != 0) {
            $(".J_mainContent").find("iframe.J_iframe").hide().parents(".J_mainContent").append(n);
        } else {
            $(".J_mainContent").append(n);
        }
    })
    return false
}

$(function() {
    function f(l) {
        var k = 0;
        $(l).each(function() {
            k += $(this).outerWidth(true)
        });
        return k
    }

    function g(n) {
        var o = f($(n).prevAll()),
            q = f($(n).nextAll());
        var l = f($(".content-tabs").children().not(".J_menuTabs"));
        var k = $(".content-tabs").outerWidth(true) - l;
        var p = 0;
        if ($(".page-tabs-content").outerWidth() < k) {
            p = 0
        } else {
            if (q <= (k - $(n).outerWidth(true) - $(n).next().outerWidth(true))) {
                if ((k - $(n).next().outerWidth(true)) > q) {
                    p = o;
                    var m = n;
                    while ((p - $(m).outerWidth()) > ($(".page-tabs-content").outerWidth() - k)) {
                        p -= $(m).prev().outerWidth();
                        m = $(m).prev()
                    }
                }
            } else {
                if (o > (k - $(n).outerWidth(true) - $(n).prev().outerWidth(true))) {
                    p = o - $(n).prev().outerWidth(true)
                }
            }
        }
        $(".page-tabs-content").animate({
            marginLeft: 0 - p + "px"
        }, "fast")
    }

    function a() {
        var o = Math.abs(parseInt($(".page-tabs-content").css("margin-left")));
        var l = f($(".content-tabs").children().not(".J_menuTabs"));
        var k = $(".content-tabs").outerWidth(true) - l;
        var p = 0;
        if ($(".page-tabs-content").width() < k) {
            return false
        } else {
            var m = $(".J_menuTab:first");
            var n = 0;
            while ((n + $(m).outerWidth(true)) <= o) {
                n += $(m).outerWidth(true);
                m = $(m).next()
            }
            n = 0;
            if (f($(m).prevAll()) > k) {
                while ((n + $(m).outerWidth(true)) < (k) && m.length > 0) {
                    n += $(m).outerWidth(true);
                    m = $(m).prev()
                }
                p = f($(m).prevAll())
            }
        }
        $(".page-tabs-content").animate({
            marginLeft: 0 - p + "px"
        }, "fast")
    }

    function b() {
        var o = Math.abs(parseInt($(".page-tabs-content").css("margin-left")));
        var l = f($(".content-tabs").children().not(".J_menuTabs"));
        var k = $(".content-tabs").outerWidth(true) - l;
        var p = 0;
        if ($(".page-tabs-content").width() < k) {
            return false
        } else {
            var m = $(".J_menuTab:first");
            var n = 0;
            while ((n + $(m).outerWidth(true)) <= o) {
                n += $(m).outerWidth(true);
                m = $(m).next()
            }
            n = 0;
            while ((n + $(m).outerWidth(true)) < (k) && m.length > 0) {
                n += $(m).outerWidth(true);
                m = $(m).next()
            }
            p = f($(m).prevAll());
            if (p > 0) {
                $(".page-tabs-content").animate({
                    marginLeft: 0 - p + "px"
                }, "fast")
            }
        }
    }
    $(".J_menuItem").each(function(k) {
        if (!$(this).attr("data-index")) {
            $(this).attr("data-index", k)
        }
    });

    function c() {
        $("#side-menu").find("li").removeClass("active");
        $("#side-menu").find("ul").removeClass("in");
        $(this).parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active");
        $(this).parent("li").addClass("active");
        $(this).parent("li").siblings("li").find("ul").slideUp(400);
        var o = $(this).attr("href"),
            m = $(this).data("index"),
            l = $.trim($(this).text()),
            k = true,
            other = $(this).data("item"),
            reload = $(this).data("reload");
        var l = "";
        if ($(this).data("message") == undefined) {
            l = $.trim($(this).text());
        } else {
            l = $(this).data("message");
        }
        if (o == undefined || $.trim(o).length == 0) {
            return false
        }
        $(".J_menuTab").each(function() {
            if ($(this).data("id") == o) {
                if (!$(this).hasClass("active")) {
                    $(this).addClass("active").siblings(".J_menuTab").removeClass("active");
                    g(this);
                    $(".J_mainContent .J_iframe").each(function() {
                        if ($(this).data("id") == o) {
                            if (reload == true) {
                                $(this).remove().siblings(".J_iframe").hide();
                                var n = '<iframe class="J_iframe" name="iframe' + m + '" width="100%" height="100%" src="' + o + '" frameborder="0" data-id="' + o + '" seamless></iframe>';
                                $(".J_mainContent").find("iframe.J_iframe").hide().parents(".J_mainContent").append(n);
                            } else {
                                $(this).show().siblings(".J_iframe").hide();
                            }
                            return false
                        }
                    })
                }
                k = false;
                return false
            }
        });
        if (other == "other") {
            $(this).parents(".dropdown").removeClass("open");
            $(".nav" + m).parents(".nav-second-level").addClass("in").parent(".nav-sec").addClass("active");
            $(".nav" + m).addClass("active");
            var fl = $(this).data("reload");

            $(".J_mainContent .J_iframe").each(function() {
                if ($(this).data("id") == o) {
                    if (fl == true) {
                        $(this).remove().siblings(".J_iframe").hide();
                        var n = '<iframe class="J_iframe" name="iframe' + m + '" width="100%" height="100%" src="' + o + '" frameborder="0" data-id="' + o + '" seamless></iframe>';
                        if ($(".J_mainContent").find("iframe.J_iframe").length != 0) {
                            $(".J_mainContent").find("iframe.J_iframe").hide().parents(".J_mainContent").append(n);
                        } else {
                            $(".J_mainContent").append(n);
                        }

                    } else {
                        $(this).show().siblings(".J_iframe").hide();
                    }
                    return false
                }
            })
        }
        if ($(this).hasClass("list-group-item")) {
            $(this).parents(".notify-wrap").removeClass("open");
            $("#notifyWrap .list-group-item").addClass("invalid-item");
            $(".msg-num").html("0").hide();

        }
        if (k) {
            var p = '<a href="javascript:;" class="active J_menuTab" data-id="' + o + '" data-index="' + m + '" data-reload="' + reload + '">' + l + ' <i class="fa fa-times-circle"></i></a>';
            $(".J_menuTab").removeClass("active");
            var n = '<iframe class="J_iframe" name="iframe' + m + '" width="100%" height="100%" src="' + o + '" frameborder="0" data-id="' + o + '" seamless></iframe>';
            $(".J_mainContent").find("iframe.J_iframe").hide().parents(".J_mainContent").append(n);
            $(".J_menuTabs .page-tabs-content").append(p);
            g($(".J_menuTab.active"));
        }
        return false
    }
    $("body").on("click", ".J_menuItem", c);

    var Go = true; //定义钩子，如果找到default则退出递归
    function returnInd(arr, ind) {
        for (var i = 0; i < arr.length; i++) {
            if (arr[i].id == ind) {
                if (Go) {
                    level = arr[i].topid;
                    var id = arr[i].id;
                    console.log(level)
                    Go = false;
                    $(".nav-left").find("li").each(function(i) {
                        if ($(this).data("index") == level) {
                            $(this).addClass("active").siblings("li").removeClass("active");
                            getSideNavData(i);
                        } else if (level == 0) {
                            $(".nav-left").find("li[data-index=" + id + "]").addClass("active").siblings("li").removeClass("active");
                        }
                    })
                    $("#side-menu").find("li").removeClass("active");
                    $("#side-menu").find("ul").removeClass("in");
                    $(".sidebar-collapse").find(".nav" + id).addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active");
                }
            } else {
                if (arr[i].children && arr[i].children.length > 0) {
                    returnInd(arr[i].children, ind);
                }
            }
        }
    }

    function h() {
        var m = $(this).parents(".J_menuTab").data("id");
        var l = $(this).parents(".J_menuTab").width();
        if ($(this).parents(".J_menuTab").hasClass("active")) {
            if ($(this).parents(".J_menuTab").next(".J_menuTab").size()) {
                var k = $(this).parents(".J_menuTab").next(".J_menuTab:eq(0)").data("id");
                var ind = $(this).parents(".J_menuTab").next(".J_menuTab:eq(0)").data("index");
                $(this).parents(".J_menuTab").next(".J_menuTab:eq(0)").addClass("active");
                $(".J_mainContent .J_iframe").each(function() {
                    if ($(this).data("id") == k) {
                        $(this).show().siblings(".J_iframe").hide();
                        return false
                    }
                });
                var n = parseInt($(".page-tabs-content").css("margin-left"));
                if (n < 0) {
                    $(".page-tabs-content").animate({
                        marginLeft: (n + l) + "px"
                    }, "fast")
                }
                $(this).parents(".J_menuTab").remove();
                $(".J_mainContent .J_iframe").each(function() {
                        if ($(this).data("id") == m) {
                            $(this).remove();
                            return false
                        }
                    })
                    //点击记录导航时
                Go = true;
                returnInd(MenuData, ind);
            }
            if ($(this).parents(".J_menuTab").prev(".J_menuTab").size()) {
                var k = $(this).parents(".J_menuTab").prev(".J_menuTab:last").data("id");
                var ind = $(this).parents(".J_menuTab").prev(".J_menuTab:last").data("index");
                console.log(k)
                $(this).parents(".J_menuTab").prev(".J_menuTab:last").addClass("active");
                $(".J_mainContent .J_iframe").each(function() {
                    if ($(this).data("id") == k) {
                        $(this).show().siblings(".J_iframe").hide();
                        return false
                    }
                });
                $(this).parents(".J_menuTab").remove();
                $(".J_mainContent .J_iframe").each(function() {
                    if ($(this).data("id") == m) {
                        $(this).remove();
                        return false
                    }
                })

                //点击记录导航时
                console.log(ind);
                Go = true;
                returnInd(MenuData, ind);
            }
        } else {
            $(this).parents(".J_menuTab").remove();
            $(".J_mainContent .J_iframe").each(function() {
                if ($(this).data("id") == m) {
                    $(this).remove();
                    return false
                }
            });
            g($(".J_menuTab.active"))
        }
        return false
    }
    $(".J_menuTabs").on("click", ".J_menuTab i", h);

    function i() {
        $(".page-tabs-content").children("[data-id]").not(":first").not(".active").each(function() {
            $('.J_iframe[data-id="' + $(this).data("id") + '"]').remove();
            $(this).remove()
        });
        $(".page-tabs-content").css("margin-left", "0")
    }
    $(".J_tabCloseOther").on("click", i);

    function j() {
        g($(".J_menuTab.active"))
    }
    $(".J_tabShowActive").on("click", j);

    function e() {
        var ind = $(this).data("index");
        var o = $(this).data("id");
        var fl = $(this).data("reload");
        if (!$(this).hasClass("active")) {
            var k = $(this).data("id");
            var ind = $(this).data("index");
            $(".J_mainContent .J_iframe").each(function() {
                if ($(this).data("id") == k) {
                    if (fl == true) {
                        $(this).remove().siblings(".J_iframe").hide();
                        var n = '<iframe class="J_iframe" name="iframe' + ind + '" width="100%" height="100%" src="' + o + '" frameborder="0" data-id="' + o + '" seamless></iframe>';
                        $(".J_mainContent").find("iframe.J_iframe").hide().parents(".J_mainContent").append(n);
                    } else {
                        $(this).show().siblings(".J_iframe").hide();

                    }
                    return false
                }
            });
            $(this).addClass("active").siblings(".J_menuTab").removeClass("active");
            g(this);
            //点击记录导航时
            Go = true;
            returnInd(MenuData, ind);
        }
    }
    $(".J_menuTabs").on("click", ".J_menuTab", e);

    function d() {
        var l = $('.J_iframe[data-id="' + $(this).data("id") + '"]');
        var k = l.attr("src")
    }
    $(".J_menuTabs").on("dblclick", ".J_menuTab", d);
    $(".J_tabLeft").on("click", a);
    $(".J_tabRight").on("click", b);
    $(".J_tabCloseAll").on("click", function() {
        $(".page-tabs-content").children("[data-id]").not(":first").each(function() {
            $('.J_iframe[data-id="' + $(this).data("id") + '"]').remove();
            $(this).remove()
        });
        $(".page-tabs-content").children("[data-id]:first").each(function() {
            $('.J_iframe[data-id="' + $(this).data("id") + '"]').show();
            $(this).addClass("active")
        });
        $(".page-tabs-content").css("margin-left", "0")
    })
});


function getSideNavData(index) { //点击顶部是切换

    if (MenuData[index] && MenuData[index].children) {
        $("#side-menu").empty();
        var sideStr = "";
        var arr = MenuData[index].children;

        function render(arr, level) {
            var level = level || 0;
            level++;
            var i = 0,
                len = arr.length;
            if (level == 1) {
                var str = '<ul id="side-menu" class="nav">'
            } else {
                str = '<ul class="nav nav-second-level collapse">'
            }
            for (; i < len; i++) {
                if (arr[i].children && arr[i].children.length > 0) {
                    str += '<li class="nav' + arr[i].id + '"><a class="has-child" href="#" data-topid=' + arr[i].topid + ' data-index="' + arr[i].id + '"><i class="fa fa_' + arr[i].class + '"></i> <span class="nav-label">' + arr[i].name + '</span><span class="fa arrow"></span></a>';
                    str += render(arr[i].children, level);
                } else {
                    if (arr[i].reload == "1") {
                        str += '<li class="nav' + arr[i].id + '"><a class="J_menuItem" href="' + arr[i].url + '" data-topid=' + arr[i].topid + ' data-index="' + arr[i].id + '" data-reload="true"><i class="fa fa_' + arr[i].class + '"></i> <span class="nav-label">' + arr[i].name + '</span></a>';
                    } else {
                        str += '<li class="nav' + arr[i].id + '"><a class="J_menuItem" href="' + arr[i].url + '" data-topid=' + arr[i].topid + ' data-index="' + arr[i].id + '" data-reload="false"><i class="fa fa_' + arr[i].class + '"></i> <span class="nav-label">' + arr[i].name + '</span></a>';
                    }
                }
                str += '</li>';
            }
            str += '</ul>';
            return str;
        }
        $(".sidebar-collapse").html(render(arr));
        resetSideBarScroll();
    } else {
        return false
    }
}
$(function() {
    function getTopNavDate() { //获取顶部导航
        var topStr = "";
        $.each(MenuData, function(i, item) {
            if (item.url == undefined) {
                if ($(window).width() > 768) {
                    topStr += '<li  data-index="' + item.id + '" data-toggle="tooltip" data-placement="bottom" title="' + item.name + '" data-i="' + i + '"><a href="#"><i class="fa ' + item.class + '"></i><span>' + item.name + '</span></a></li>'
                } else {
                    topStr += '<li data-index="' + item.id + '" data-toggle="tooltip" data-placement="bottom" title="' + item.name + '" data-i="' + i + '"><a href="#"><i class="fa ' + item.class + '"></i><span>' + item.name + '</span></a></li>'
                }
            } else {
                topStr += '<li data-index="' + item.id + '" data-toggle="tooltip" data-placement="bottom" title="' + item.name + '" data-i="' + i + '"><a href="' + item.url + '" data-index="' + item.id + '" class="J_menuItem"><i class="fa ' + item.class + '"></i><span>' + item.name + '</span></a></li>'
            }
        })
        $(".navbar-static-top ul.nav-left").prepend(topStr);
    }
    getTopNavDate();

    function hideTopli() { //顶部导航超出隐藏
        $("#navbarSubMenu ul").html("");
        var topW = $(".nav-left").width();
        var w = 0,
            ww = 0;
        $(".nav-left").find("li").each(function(i) {
            var liW = parseInt($(this).outerWidth());
            if ($("body").width() < 768) {
                liW = 53;
            }
            $(this).show();
            w += liW;
            if (w > topW) {

                $("#navbarSubMenu").show().children('a').css("display", "block");
                var t = $(this).clone();
                $("#navbarSubMenu ul").append($(this).clone());
                $(this).hide();

            } else {
                $("#navbarSubMenu").hide().children('a').css("display", "none");
                ww += liW;
                $("#navbarSubMenu").css("left", ww + 10)
            }
        })

    }
    hideTopli();
    $(window).resize(function() {
        hideTopli();
        // var topW = $(".nav-left").width();
        // var w = 0;
        // // if($("body").width()>768){
        //     $(".nav-left").find("li").each(function(i){
        //         var liW = parseInt($(this).outerWidth());
        //         w += liW;
        //         if(w>topW){
        //             $("#navbarSubMenu ").css("display","block");
        //         }else{
        //             $("#navbarSubMenu ").css("display","none");
        //         }
        //     })
        // }else{
        //     $("#navbarSubMenu ").css("display","none");
        // }
    });

    //防止字体文件还未加载完成时就执行js导致这里的宽度计算误差
    $(window).on('load', function(e) {
        hideTopli();
    });
    //收起喝展开的时候重新计算顶部导航条
    $(".navbar-minimalize").click(function() {
        hideTopli();
    });
    //获取初始导航
    var isGo = true; //定义钩子，如果找到default则退出递归
    var flag = 0;

    function render(arr, level) {
        var level = 0;
        for (var i = 0; i < arr.length; i++) {
            if (arr[i].default == "1") {
                if (isGo) {
                    if (arr[i].reload == "1") {
                        fixNav = '<a href="javascript:;" class="active J_menuTab"  data-id="' + arr[i].url + '" data-index="' + arr[i].id + '" data-reload="true">' + arr[i].name + '</a>';
                    } else {
                        fixNav = '<a href="javascript:;" class="active J_menuTab"  data-id="' + arr[i].url + '" data-index="' + arr[i].id + '" data-reload="false">' + arr[i].name + '</a>';
                    }
                    iframe = ' <iframe class="J_iframe" name="iframe0" width="100%" height="100%" src=" ' + arr[i].url + '" frameborder="0"' +
                        'data-id="' + arr[i].url + '" seamless id="iframe"></iframe>'
                    $(".page-tabs-content").append(fixNav);
                    $("#content-main").append(iframe);
                    level = arr[i].id;
                    isGo = false;
                    flag = 1;
                    var pId = arr[i].parentid;
                    var topId = arr[i].topid;
                    $(".nav-left").find("li").each(function(i) {
                        if ($(this).data("index") == topId) {
                            getSideNavData(i);
                        }
                    })
                    $("#side-menu").find("li").removeClass("active");
                    $("#side-menu").find("ul").removeClass("in");
                    $(".sidebar-collapse").find(".nav" + level).addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active");
                    $(".navbar-static-top").find("li[data-index=" + topId + "]").addClass("active");
                }
            } else {
                if (arr[i].children && arr[i].children.length > 0) {
                    render(arr[i].children);
                }
            }
        }
    }
    render(MenuData);
    if (flag == 0) { //如果没有default
        //获取初始导航
        var flagGo = true; //定义钩子，如果找到default则退出递归
        function render2(arr, level) {
            var level = 0;
            for (var i = 0; i < arr.length; i++) {
                if (arr[i].url) {;
                    if (flagGo) {
                        if (arr[i].reload == "1") {
                            fixNav = '<a href="javascript:;" class="active J_menuTab"  data-id="' + arr[i].url + '" data-index="' + arr[i].id + '" data-reload="true">' + arr[i].name + '</a>';
                        } else {
                            fixNav = '<a href="javascript:;" class="active J_menuTab"  data-id="' + arr[i].url + '" data-index="' + arr[i].id + '" data-reload="false">' + arr[i].name + '</a>';
                        }
                        iframe = ' <iframe class="J_iframe" name="iframe0" width="100%" height="100%" src=" ' + arr[i].url + '" frameborder="0"' +
                            'data-id="' + arr[i].url + '" seamless id="iframe"></iframe>'
                        $(".page-tabs-content").append(fixNav);
                        $("#content-main").append(iframe);
                        level = arr[i].id;
                        flagGo = false;
                        var pId = arr[i].parentid;
                        var topId = arr[i].topid;
                        $(".nav-left").find("li").each(function(i) {
                            if ($(this).data("index") == topId) {
                                getSideNavData(i);
                            }
                        })
                        $("#side-menu").find("li").removeClass("active");
                        $("#side-menu").find("ul").removeClass("in");
                        $(".sidebar-collapse").find(".nav" + level).addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active");
                        $(".navbar-static-top").find("li[data-index=" + topId + "]").addClass("active");
                    }
                } else {
                    if (arr[i].children && arr[i].children.length > 0) {
                        render2(arr[i].children);
                    }
                }
            }
        }
        render2(MenuData);
    }

    $("body").find(".navbar-static-top .nav-left li").each(function(i) {
        $(this).on("click", function() {
            var ind = $(this).data("i")
            $("#navbarSubMenu").removeClass("open");
            var index = $(this).data("index");
            $(this).addClass("active").siblings("li").removeClass("active");
            $("#navbarSubMenu ul li").removeClass("active");
            getSideNavData(ind);

        })
    })
    $("#navbarSubMenu").on("click", "ul li", function() {
        var ind = $(this).data("i");
        $(this).parents("#navbarSubMenu").parents("ul.nav-left").find("li").removeClass("active");
        $(this).addClass("active");
        $("#navbarSubMenu").children('.dropdown-toggle').dropdown('toggle');
        getSideNavData(ind);
    })
    $(window).resize(function() {
        $("#navbarSubMenu").on("click", "ul li", function() {
            var ind = $(this).data("i");
            $(this).parents("#navbarSubMenu").siblings("ul.nav-left").children("li").removeClass("active");
            $(this).addClass("active").siblings("li").removeClass("active");
            getSideNavData(ind);
        })
    });


    $("body").on("click", ".has-child", function() { //导航展开收缩
        $(this).siblings("ul").slideToggle(400);
        $(this).parent("li").siblings("li").find("ul").slideUp(400);
        if ($(this).siblings("ul").hasClass("in")) {
            $(this).siblings("ul").removeClass("in");
            $(this).parent("li").removeClass("active");
        } else {
            $(this).parent("li").siblings("li").removeClass("active").children("ul").removeClass("in");
            $(this).parent("li").addClass("active");
            $(this).siblings("ul").addClass("in");
            $(this).siblings("ul").find(".in").slideDown();
        }
    });


    //为小导航栏追加事件
    $('html').on('slimscrolling', '.mini-navbar .navbar-static-side .sidebar-collapse', function(e, top) {
        $(this).css('transform', 'translate3d(0,-' + top + 'px,0)')
    });
    //切换导航条类型是重置滚动高度
    $(".navbar-minimalize").click(resetSideBarScroll);
    //小导航点击后收起展开的菜单
    $("body").on("click", ".J_menuItem", function(e) {
        if ($('body').hasClass('mini-navbar') && !$(this).hasClass('has-child')) {
            $("#side-menu").find("ul").removeClass("in").hide();
        }
    });

})

function resetSideBarScroll() {
    $(".sidebar-collapse").css('transform', 'translate3d(0,0,0)')
}