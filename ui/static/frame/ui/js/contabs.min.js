
$(function () {
    function f(l) {
        var k = 0;
        $(l).each(function() {
            k += $(this).outerWidth(true)
        });
        return k
    }
    function g(n) {
        var o = f($(n).prevAll())
            , q = f($(n).nextAll());
        var l = f($(".content-tabs").children().not(".J_menuTabs"));
        var k = $(".content-tabs").outerWidth(true) - l;
        var p = 0;
        if ($(".page-tabs-content").outerWidth() < k) {
            p = 0
        } else {
            if (q <= (k - $(n).outerWidth(true) - $(n).next().outerWidth(true))) {
                if ((k - $(n).next().outerWidth(true)) > q) {
                    p = o;
                    var m = n;
                    while ((p - $(m).outerWidth()) > ($(".page-tabs-content").outerWidth() - k)) {
                        p -= $(m).prev().outerWidth();
                        m = $(m).prev()
                    }
                }
            } else {
                if (o > (k - $(n).outerWidth(true) - $(n).prev().outerWidth(true))) {
                    p = o - $(n).prev().outerWidth(true)
                }
            }
        }
        $(".page-tabs-content").animate({
            marginLeft: 0 - p + "px"
        }, "fast")
    }
    function a() {
        var o = Math.abs(parseInt($(".page-tabs-content").css("margin-left")));
        var l = f($(".content-tabs").children().not(".J_menuTabs"));
        var k = $(".content-tabs").outerWidth(true) - l;
        var p = 0;
        if ($(".page-tabs-content").width() < k) {
            return false
        } else {
            var m = $(".J_menuTab:first");
            var n = 0;
            while ((n + $(m).outerWidth(true)) <= o) {
                n += $(m).outerWidth(true);
                m = $(m).next()
            }
            n = 0;
            if (f($(m).prevAll()) > k) {
                while ((n + $(m).outerWidth(true)) < (k) && m.length > 0) {
                    n += $(m).outerWidth(true);
                    m = $(m).prev()
                }
                p = f($(m).prevAll())
            }
        }
        $(".page-tabs-content").animate({
            marginLeft: 0 - p + "px"
        }, "fast")
    }
    function b() {
        var o = Math.abs(parseInt($(".page-tabs-content").css("margin-left")));
        var l = f($(".content-tabs").children().not(".J_menuTabs"));
        var k = $(".content-tabs").outerWidth(true) - l;
        var p = 0;
        if ($(".page-tabs-content").width() < k) {
            return false
        } else {
            var m = $(".J_menuTab:first");
            var n = 0;
            while ((n + $(m).outerWidth(true)) <= o) {
                n += $(m).outerWidth(true);
                m = $(m).next()
            }
            n = 0;
            while ((n + $(m).outerWidth(true)) < (k) && m.length > 0) {
                n += $(m).outerWidth(true);
                m = $(m).next()
            }
            p = f($(m).prevAll());
            if (p > 0) {
                $(".page-tabs-content").animate({
                    marginLeft: 0 - p + "px"
                }, "fast")
            }
        }
    }

    function c() {
        var pars = $(this).parent().parent();
        $("#side-menu").find("li").removeClass("active");
        $("#side-menu").find("ul").removeClass("in");
        $(this).parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active");
        $(this).parent("li").addClass("active");
        $(this).parent("li").siblings("li").find("ul").slideUp(400);
        $(".nav-phone-wrap #side-menu").hide();
        $(".nav-phone-header").attr("flag","flag");

        var o = $(this).attr("href")
            , m = $(this).data("index")
            , k = true
            ,other = $(this).data("item")
            ,reload=$(this).data("reload");
        var l = "";
        if($(this).data("message")==undefined){
            l = $.trim($(this).text());
        }else{
            l = $(this).data("message");
        }
        console.log(l)
        if (m == undefined || $.trim(m).length == 0) {
            return false
        }
        $(".J_menuTab").each(function() {
            if ($(this).data("id") == o) {
                if (!$(this).hasClass("active")) {
                    $(this).addClass("active").siblings(".J_menuTab").removeClass("active");
                    g(this);
                    $(".J_mainContent .J_iframe").each(function() {
                        if ($(this).data("id") ==o) {
                            if(reload==true){
                                $(this).remove().siblings(".J_iframe").hide();
                                var n = '<iframe class="J_iframe" name="iframe' + m + '" width="100%" height="100%" src="' + o + '" frameborder="0" data-id="' + o + '" seamless></iframe>';
                                $(".J_mainContent").find("iframe.J_iframe").hide().parents(".J_mainContent").append(n);
                            }else{
                                $(this).show().siblings(".J_iframe").hide();
                            }
                            return false
                        }
                    })
                }
                k = false;
                return false
            }
        });
        if(other=="other"){
            $(this).parents(".dropdown").removeClass("open");
            $(".nav"+m).parents(".nav-second-level").addClass("in").parent(".nav-sec").addClass("active");
            $(".nav"+m).addClass("active");
            var fl = $(this).data("reload");

            $(".J_mainContent .J_iframe").each(function() {
                if ($(this).data("id") ==o) {
                    if(fl==true){
                        $(this).remove().siblings(".J_iframe").hide();
                        var n = '<iframe class="J_iframe" name="iframe' + m + '" width="100%" height="100%" src="' + o + '" frameborder="0" data-id="' + o + '" seamless></iframe>';
                        if($(".J_mainContent").find("iframe.J_iframe").length!=0){
                            $(".J_mainContent").find("iframe.J_iframe").hide().parents(".J_mainContent").append(n);
                        }else{
                            $(".J_mainContent").append(n);
                        }

                    }else{
                        $(this).show().siblings(".J_iframe").hide();
                    }
                    return false
                }
            })
        }
        if($(this).hasClass("list-group-item")){
            $(this).parents(".notify-wrap").removeClass("open");
            $("#notifyWrap .list-group-item").addClass("invalid-item");
            $(".msg-num").html("0").hide();
        }
        if (k) {
            var p = '<a href="javascript:;" class="active J_menuTab" data-id="' + o + '" data-index="'+m+'" data-reload="'+reload+'">' + l + ' <i class="fa fa-times-circle"></i></a>';
            $(".J_menuTab").removeClass("active");
            var n = '<iframe class="J_iframe" name="iframe' + m + '" width="100%" height="100%" src="' + o + '" frameborder="0" data-id="' + o + '" seamless></iframe>';
            $(".J_mainContent").find("iframe.J_iframe").hide().parents(".J_mainContent").append(n);
            $(".J_menuTabs .page-tabs-content").append(p);
            g($(".J_menuTab.active"))
        }

        return false

    }

    $("body").on("click",".J_menuItem" ,c);
    function h() {

        var m = $(this).parents(".J_menuTab").data("id");
        var l = $(this).parents(".J_menuTab").width();
        var ind;
        if ($(this).parents(".J_menuTab").hasClass("active")) {
            if ($(this).parents(".J_menuTab").next(".J_menuTab").size()) {
                var k = $(this).parents(".J_menuTab").next(".J_menuTab:eq(0)").data("id");
                ind = $(this).parents(".J_menuTab").next(".J_menuTab:eq(0)").data("index");
                $(this).parents(".J_menuTab").next(".J_menuTab:eq(0)").addClass("active");
                $(".J_mainContent .J_iframe").each(function() {
                    if ($(this).data("id") == k) {
                        $(this).show().siblings(".J_iframe").hide();
                        return false
                    }
                });
                var n = parseInt($(".page-tabs-content").css("margin-left"));
                if (n < 0) {
                    $(".page-tabs-content").animate({
                        marginLeft: (n + l) + "px"
                    }, "fast")
                }
                $(this).parents(".J_menuTab").remove();
                $(".J_mainContent .J_iframe").each(function() {
                    if ($(this).data("id") == m) {
                        $(this).remove();
                        return false
                    }
                })
            }
            if ($(this).parents(".J_menuTab").prev(".J_menuTab").size()) {

                var k = $(this).parents(".J_menuTab").prev(".J_menuTab:last").data("id");
                ind = $(this).parents(".J_menuTab").prev(".J_menuTab:last").data("index");
                $(this).parents(".J_menuTab").prev(".J_menuTab:last").addClass("active");
                $(".J_mainContent .J_iframe").each(function() {
                    if ($(this).data("id") == k) {
                        $(this).show().siblings(".J_iframe").hide();
                        return false
                    }
                });
                $(this).parents(".J_menuTab").remove();
                $(".J_mainContent .J_iframe").each(function() {
                    if ($(this).data("id") == m) {
                        $(this).remove();
                        return false
                    }
                })
            }
            $("#side-menu").find("li").removeClass("active");
            $("#side-menu").find("ul").removeClass("in");
            $(".sidebar-collapse").find(".nav"+ind).addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active");
            $(".sidebar-collapse").find(".nav"+ind).siblings("li").find("ul").slideUp(400);

        } else {
            $(this).parents(".J_menuTab").remove();
            $(".J_mainContent .J_iframe").each(function() {
                if ($(this).data("id") == m) {
                    $(this).remove();
                    return false
                }
            });
            g($(".J_menuTab.active"))
        }
        return false
    }
    $(".J_menuTabs").on("click", ".J_menuTab i", h);
    function i() {
        $(".page-tabs-content").children("[data-id]").not(":first").not(".active").each(function() {
            $('.J_iframe[data-id="' + $(this).data("id") + '"]').remove();
            $(this).remove()
        });
        $(".page-tabs-content").css("margin-left", "0")
    }
    $(".J_tabCloseOther").on("click", i);
    function j() {
        g($(".J_menuTab.active"))
    }
    $(".J_tabShowActive").on("click", j);
    function e() {
        var ind = $(this).data("index");
        var o = $(this).data("id");
        var fl = $(this).data("reload");


        if (!$(this).hasClass("active")) {
            var k = $(this).data("id");
            $(".J_mainContent .J_iframe").each(function() {
                if ($(this).data("id") == k) {
                    if(fl==true){
                        $(this).remove().siblings(".J_iframe").hide();
                        var n = '<iframe class="J_iframe" name="iframe' + ind + '" width="100%" height="100%" src="' + o + '" frameborder="0" data-id="' + o + '" seamless></iframe>';
                        $(".J_mainContent").find("iframe.J_iframe").hide().parents(".J_mainContent").append(n);
                    }else{
                        $(this).show().siblings(".J_iframe").hide();

                    }

                }
            });
            $(this).addClass("active").siblings(".J_menuTab").removeClass("active");
            g(this)
        }

        var item = $(".J_menuItem");
        $("#side-menu").find("li").removeClass("active");
        $("#side-menu").find("ul").removeClass("in");
        $(".sidebar-collapse").find(".nav"+ind).addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active");
        $(".sidebar-collapse").find(".nav"+ind).siblings("li").find("ul").slideUp(400);
    }
    $(".J_menuTabs").on("click", ".J_menuTab", e);
    function d() {
        var l = $('.J_iframe[data-id="' + $(this).data("id") + '"]');
        var k = l.attr("src")
    }
    $(".J_menuTabs").on("dblclick", ".J_menuTab", d);
    $(".J_tabLeft").on("click", a);
    $(".J_tabRight").on("click", b);
    $(".J_tabCloseAll").on("click", function() {
        $(".page-tabs-content").children("[data-id]").not(":first").each(function() {
            $('.J_iframe[data-id="' + $(this).data("id") + '"]').remove();
            $(this).remove()
        });
        $(".page-tabs-content").children("[data-id]:first").each(function() {
            $('.J_iframe[data-id="' + $(this).data("id") + '"]').show();
            $(this).addClass("active")
        });
        $(".page-tabs-content").css("margin-left", "0")
    })
});





$(function(){
    var firstStr="";
    function getSideFirstNav(){
        alert("xx");
        for(var i = 0;i<MenuData.length;i++){
            if(MenuData[i].children!=undefined){
                firstStr='<li class="nav-sec nav'+MenuData[i].id+' nav-first" >' +
                    '<a href="#" data-index="'+MenuData[i].id+'" class="has-child" >' +
                    '<i class="fa '+ MenuData[i].class+'"></i> ' +
                    '<span class="nav-label">'+MenuData[i].name+'</span>' +
                    '<span class="fa arrow"></span>'+
                    '</a></li>';
                $("#side-menu").append(firstStr);
            }else{
                firstStr = '<li class="nav'+MenuData[i].id+' nav-first">' +
                    '<a class="J_menuItem" data-reload="'+MenuData[i].reload+'" href="'+MenuData[i].url+'" data-index="'+MenuData[i].id+'"><i class="fa ' + MenuData[i].class+'"></i> <span class="nav-label">'+MenuData[i].name+'</span></a>' +
                    '</li>';

                $("#side-menu").append(firstStr);
            }

        }

    }
    getSideFirstNav();

    $("body").find(".nav-first").each(function(i){
        if($(this).hasClass("nav-sec")){
            getSideNavData(i);
        }
    })


    function getSideNavData(index){  //点击顶部是切换

        if(MenuData[index].children){
            //$("#side-menu").empty();
            var sideStr = "";
            var arr = MenuData[index].children;
            function render(arr,level){
                var level=level||0;
                level++;
                var i= 0,len=arr.length;

                str='<ul class="nav nav-second-level collapse">'

                for(;i<len;i++){
                    if(arr[i].children&&arr[i].children.length>0){
                        str+='<li class="nav'+arr[i].id+'"><a class="has-child" href="#" data-index="'+arr[i].id+'"><i class="fa fa_'+arr[i].class+'"></i> <span class="nav-label">'+arr[i].name+'</span><span class="fa arrow"></span></a>' ;
                        str+=render(arr[i].children,level);
                    }else{
                        if(arr[i].reload=="1"){
                            str+='<li class="nav'+arr[i].id+'"><a class="J_menuItem" href="'+arr[i].url+'" data-index="'+arr[i].id+'" data-reload="true"><i class="fa fa_'+arr[i].class+'"></i> <span class="nav-label">'+arr[i].name+'</span></a>' ;
                        }else{
                            str+='<li class="nav'+arr[i].id+'"><a class="J_menuItem" href="'+arr[i].url+'" data-index="'+arr[i].id+'" data-reload="false"><i class="fa fa_'+arr[i].class+'"></i> <span class="nav-label">'+arr[i].name+'</span></a>' ;
                        }
                    }
                    str+='</li>';
                }
                str+='</ul>';
                return str;
            }
            $("body").find(".nav-first").eq(index).append(render(arr));
        }else{
            return false
        }
    }
    $("body").on("click",".has-child",function(){ //导航展开收缩
        $(this).siblings("ul").slideToggle(400);
        $(this).parent("li").siblings("li").find("ul").slideUp(400);
        if($(this).siblings("ul").hasClass("in")){
            $(this).siblings("ul").removeClass("in");
            $(this).parent("li").removeClass("active");
        }else{
            $(this).parent("li").siblings("li").removeClass("active").children("ul").removeClass("in");
            $(this).parent("li").addClass("active");
            $(this).siblings("ul").addClass("in");
            $(this).siblings("ul").find(".in").slideDown();
        }
    })

    //获取初始导航
    var isGo = true;  //定义钩子，如果找到default则退出递归
    var flag = 0;
    function render(arr,level){
        var level=0;
        for(var i=0;i<arr.length;i++){
            if(arr[i].default=="1"){
                if(isGo){
                    if(arr[i].reload=="1"){
                        fixNav = '<a href="javascript:;" class="active J_menuTab" data-id="'+arr[i].url+'" data-index="'+arr[i].id+'" data-reload="true">'+arr[i].name+'</a>';
                    }else{
                        fixNav = '<a href="javascript:;" class="active J_menuTab" data-id="'+arr[i].url+'" data-index="'+arr[i].id+'" data-reload="false">'+arr[i].name+'</a>';
                    }
                    iframe=' <iframe class="J_iframe" name="iframe0" width="100%" height="100%" src=" '+arr[i].url+'" frameborder="0"'+
                        'data-id="'+arr[i].url+'" seamless id="iframe"></iframe>'
                    $(".page-tabs-content").append(fixNav);
                    $("#content-main").append(iframe);
                    level= arr[i].id;
                    isGo=false;
                    flag = 1;
                    var pId = arr[i].parentid;
                    var topId = arr[i].topid;
                    $(".nav-left").find("li").each(function(i){
                        if($(this).data("index")==topId){
                            getSideNavData(i);
                        }
                    })
                    $("#side-menu").find("li").removeClass("active");
                    $("#side-menu").find("ul").removeClass("in");
                    $(".sidebar-collapse").find(".nav"+level).addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active");
                    $(".navbar-static-top").find("li[data-index="+topId+"]").addClass("active");
                }
            }else{
                if(arr[i].children && arr[i].children.length>0 ){
                    render(arr[i].children);
                }
            }
        }
    }
    render(MenuData);
    if(flag==0){ //如果没有default
        //获取初始导航
        var flagGo = true;  //定义钩子，如果找到default则退出递归
        function render2(arr,level){
            var level=0;
            for(var i=0;i<arr.length;i++){
                if(arr[i].url){;
                    if(flagGo){
                        if(arr[i].reload=="1"){
                            fixNav = '<a href="javascript:;" class="active J_menuTab" data-id="'+arr[i].url+'" data-index="'+arr[i].id+'" data-reload="true">'+arr[i].name+'</a>';
                        }else{
                            fixNav = '<a href="javascript:;" class="active J_menuTab" data-id="'+arr[i].url+'" data-index="'+arr[i].id+'" data-reload="false">'+arr[i].name+'</a>';
                        }
                        iframe=' <iframe class="J_iframe" name="iframe0" width="100%" height="100%" src=" '+arr[i].url+'" frameborder="0"'+
                            'data-id="'+arr[i].url+'" seamless id="iframe"></iframe>'
                        $(".page-tabs-content").append(fixNav);
                        $("#content-main").append(iframe);
                        level= arr[i].id;
                        flagGo=false;
                        var pId = arr[i].parentid;
                        var topId = arr[i].topid;
                        $(".nav-left").find("li").each(function(i){
                            if($(this).data("index")==topId){
                                getSideNavData(i);
                            }
                        })
                        $("#side-menu").find("li").removeClass("active");
                        $("#side-menu").find("ul").removeClass("in");
                        $(".sidebar-collapse").find(".nav"+level).addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active");
                        $(".navbar-static-top").find("li[data-index="+topId+"]").addClass("active");
                    }
                }else{
                    if(arr[i].children && arr[i].children.length>0 ){
                        render2(arr[i].children);
                    }
                }
            }
        }
        render2(MenuData);
    }
})




$(function () {
    function miniNavBar() {
        var bodyW = $(window).width();
        if (bodyW > 768) {
            $("body").removeClass("mini-navbar");
            $(".nav-second-level").css("top","0")
        } else {
            $("body").addClass("mini-navbar");
            $(".nav-second-level").each(function(){
                var oT = $(this).parent("li").offset().top;;
                $(this).css("top",oT)
            })
        }
    }

    miniNavBar();
    $(window).resize(function () {
        miniNavBar();
        navCopyto();
    });
    var bodyW = "";
    function navCopyto() {
        bodyW = $(window).width();
        var str = $(".copyNav");
        if (bodyW < 768) {
            $(".nav-phone-wrap").append(str);
            $(".nav-phone-header").html($("#side-menu .active .J_menuItem").html());
            $(".nav-phone-wrap").show();
        } else {
            $(".nav-phone-wrap").hide();
            $(".nav-phone-wrap #side-menu").show();
            $(".sidebar-collapse").append(str)
        }
    }
    if (bodyW < 768) {
        navCopyto();
    }

    $("body").on("click",".nav-phone-header",function(){
        if( $(this).attr("flag")=="flag"){
            $(".nav-phone-wrap #side-menu").show();
            $(this).attr("flag","")
        }else{
            $(".nav-phone-wrap #side-menu").hide();
            $(this).attr("flag","flag")
        }

    })

    function getInitUrl(){
        var ind = $(".page-tabs-content").find("a").eq(0).data("index");
        //$("#side-menu").find("a.J_menuItem").eq(ind).parent("li").addClass("active").parent("ul").addClass("in").parent("li").addClass("active")
    }
    getInitUrl();

})